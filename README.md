# 周波数解析データセット (Frequency Analysis Toolkit)

時系列データのバイナリ読み込みから、前処理（トリミング）、FFT 解析、統計量算出、そして可視化までを一貫して行う Python パイプラインツールです。
各解析結果を周波数帯域（ビン）ごとに集計し、時間変化やフォルダ間の比較を視覚的に把握できます。

## 1. 機能概要

### A. データ処理・解析

- **データ変換**: 独自バイナリ形式 (`.bin`) から物理量 CSV への変換。
- **前処理**: 解析区間のトリミング機能。
- **周波数解析**: 高速フーリエ変換 (FFT) によるスペクトル解析。
- **統計解析**:
  - **基本統計量**: 平均, 分散, 最大/最小値, エネルギー, 最大振幅など。
  - **バンド別解析**: 周波数帯域（10Hz 区切り）ごとの詳細統計。
  - **差分解析**: 異なる測定データ間のスペクトル差分の算出。

### B. 可視化・異常検知

- **静的グラフ (PNG)**:
  - 時系列波形 & FFT スペクトルの比較、統計量の時系列推移、FFT 差分棒グラフ。
- **インタラクティブグラフ (HTML)**:
  - **個別帯域プロット**: フォルダ間の統計推移を比較。正常データに基づく基準線（$\mu, \pm\sigma, \pm2\sigma, \pm3\sigma$）を表示。
  - **総合ダッシュボード**: 全フォルダ・全指標を 1 画面で分析。異常トレンドと Z-score ヒートマップを表示。
- **異常検知・ロギング**:
  - 正常データからの乖離（$\sigma$ 閾値）に基づく自動検知。
  - 統計的な基準値（$\mu, \sigma$）、異常件数サマリー、詳細ログの CSV 出力。

---

## 2. ディレクトリ構造とコード解説

### プロジェクト構成

```
project_root/
├── main.py                    # 解析パイプラインの実行用エントリーポイント
├── src/                       # ソースコード
│   ├── config.py              # 全体の設定 (解析対象、パラメータ、出力先)
│   ├── plot_combined_interactive.py # 統合プロット & 異常検知ロジック
│   ├── plot_anomaly_dashboard.py    # 【新規】総合ダッシュボード生成
│   └── (その他解析モジュール)
├── がたつき解析/              # 【出力】解析結果の主格納先
│   └── 帯域別統計量の時間推移/
│       ├── html/              # 個別帯域のHTMLグラフ
│       ├── 総合ダッシュボード.html # 全体俯瞰用ダッシュボード
│       ├── reference_stats.csv # 算出された基準値
│       ├── anomaly_counts.csv  # 異常発生数のサマリー
│       └── anomaly_details.csv # 異常検知の詳細ログ
└── README.md
```

### 主要ツールの役割

- **`src/plot_combined_interactive.py`**: 各帯域の HTML グラフを生成し、同時に正常データを基準とした異常検知を行い、CSV ログを出力します。
- **`src/plot_anomaly_dashboard.py`**: 生成された CSV を元に、プルダウン切替機能を備えた統合分析画面（Z-score 表示）を生成します。

---

## 3. 使い方（主要コマンド）

### 【NEW】異常検知・統合可視化

1.  **帯域別解析 & 異常検知実行**:
    ```bash
    python src/plot_combined_interactive.py
    ```
    - `がたつき解析/帯域別統計量の時間推移/` に個別グラフと CSV ログが生成されます。
2.  **総合ダッシュボードの生成**:
    ```bash
    python src/plot_anomaly_dashboard.py
    ```
    - 分析の拠点となる `総合ダッシュボード.html` が生成されます。

---

## 4. 異常検知の考え方と確認方法

### 異常度の指標 (Z-score)

ダッシュボードでは、正常データからの乖離を **Z-score**（$\sigma$ 何個分か）で表現しています。

- **Z=0**: 平均的
- **Z≧3**: 統計的に極めて稀な値（強い異常の疑い）

### 出力データの見方

- **`anomaly_counts.csv`**: 全帯域のうち何個が異常だったか。システム全体の「荒れ具合」を計れます。
- **`anomaly_details.csv`**: どの周波数（Hz）で異常が起きたかの証拠ログ。原因究明に使用します。
- **`総合ダッシュボード.html`**: 上記を視覚的に統合。プルダウンで指標を切り替えて多角的に分析できます。
